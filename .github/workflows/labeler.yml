name: "Label Pull Requests"

# Note: pull_request_target is used instead of pull_request to allow labeling
# PRs from forks. This is safe because we only checkout the base branch
# (target of the PR) and do not execute any untrusted code from the PR.
#
# Security measures implemented per zizmor recommendations:
# 1. Branch filter: Only runs for PRs targeting main branch
# 2. Repository check: Only runs in the main repository, not in forks
# 3. Base branch checkout: Only checks out the target branch, not PR code
on:
  pull_request_target:
    branches:
      - main

jobs:
  label:
    # Only run for the main repository, not in forks
    if: github.repository == 'jawsbaek/helm-charts'
    permissions:
      contents: read
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      # Checkout base branch only to access labeler configuration
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.base_ref }}
          persist-credentials: false
      - uses: actions/labeler@v6
        with:
          repo-token: "${{ secrets.GITHUB_TOKEN }}"
          configuration-path: ".github/config/labeler.yaml"
